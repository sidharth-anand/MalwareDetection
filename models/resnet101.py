import tensorflow as tf

from core.model import Model

class ResNet101(Model):
    INPUT_SIZE = (224, 224)
    INPUT_CHANNELS = 3

    def __init__(self, num_classes: int) -> None:
        super().__init__()

        self.base_model = tf.keras.applications.ResNet101V2(weights='imagenet', input_shape=(ResNet101.INPUT_SIZE[0], ResNet101.INPUT_SIZE[1], ResNet101.INPUT_CHANNELS), include_top=False)
        self.base_model.trainable = False

        self.pool = tf.keras.layers.GlobalAveragePooling2D()
        self.dense_output = tf.keras.layers.Dense(num_classes, kernel_initializer=tf.keras.initializers.GlorotUniform(), activation=tf.keras.activations.sigmoid)

    def call(self, inputs: tf.Tensor) -> tf.Tensor:
        x =  tf.keras.applications.resnet_v2.preprocess_input(inputs)

        x = self.base_model(x, training=False)
        x = self.pool(x)
        x = self.dense_output(x)

        return x